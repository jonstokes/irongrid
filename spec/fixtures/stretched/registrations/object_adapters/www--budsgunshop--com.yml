---
object_adapter:
  www.budsgunshop.com/product_link:
    $key: globals/product_link # This loads global scripts manifest
    schema: ProductLink
    queue: www.budsgunshop.com/product_links
    xpath: //span[@class="productListing-productname"]/a
    attribute:
      product_link:
        - find_by_xpath:
            xpath: ./@href
  www.budsgunshop.com/product_page:
    $key: globals/product_page
    queue: www.budsgunshop.com/listings
    scripts:
      - globals/product_page
      - www.budsgunshop.com/script
    schema: Listing
    xpath: '/html'
    attribute:
      #
      # Listing attributes
      #
      type: [{ value: RetailListing }]
      location: [{ value: "1105 Industry Road Lexington, KY 40505" }]
      title:
        - meta_title: ~
        - meta_og_title: ~
        - find_by_xpath:
            xpath: .//title
      description:
        - meta_og_description: ~
        - meta_description: ~
        - find_by_xpath:
            xpath: .//td[@class="main"]/p
      keywords:
        - meta_keywords: ~
      image:
        - meta_og_image: ~
        - find_by_xpath:
            xpath: .//div[@style="padding:0px 8px 2px 8px;"]//img/@src
            pattern: !ruby/regexp '/images\/.*jpg/'
          filters:
            - prefix: http://www.budsgunshop.com/catalog/
      sale_price_in_cents:
        - find_by_xpath:
            xpath: './/tr[@id="x2d"]/td[2]/div[1]/div[1]/div[2]/strong'
            pattern: !ruby/regexp '/^\$\d[\d\,\.]+/i'
      price_in_cents:
        - find_by_xpath:
            xpath: .//a[@id="buy"]/span
            pattern: !ruby/regexp '/^\$\d[\d\,\.]+/i'
        - find_by_xpath:
            xpath: './/tr[@id="x2d"]/td[2]/div[1]/div[1]/div[1]'
            pattern: !ruby/regexp '/^\$\d[\d\,\.]+/i'
      price_on_request:
        - find_by_xpath:
            xpath: .//a[@id="get_price_quote"]/@alt
            pattern: !ruby/regexp '/Get Quote/'
      availability:
        - label_by_xpath:
            label: out_of_stock
            xpath: .//span[@style="color:red; background:black; padding:3"]
            pattern: !ruby/regexp '/^Currently unavailable/i'
        - label_by_xpath:
            label: out_of_stock
            xpath: .//div/font[@color="red"]
            pattern: !ruby/regexp '/OUT OF STOCK/'
        - value: in_stock
      type:
        - label_by_url:
            label: auction
            pattern: !ruby/regexp '/auction_info.*auctions_id/'
        - label_by_url:
            label: retail
            pattern: !ruby/regexp '/product_info.*products_id/'
        - value: RetailListing
      condition:
        - label_by_xpath:
            label: New
            xpath: .//span[@style="font-size:9pt; color:#990000; font-weight:bold;"]
            pattern: !ruby/regexp '/Factory New/'
        - label_by_xpath:
            label: Used
            xpath: .//span[@style="font-size:9pt; color:#990000; font-weight:bold;"]
            pattern: !ruby/regexp '/Used/'
        - value: new
      current_bid_in_cents:
        - find_by_xpath:
            xpath: .//td[@class="main"]/b[. = "Auction price:"]/following-sibling::text()
            pattern: !ruby/regexp '/\$\d[\d\,\.]+/i'
      auction_ends:
        - find_by_xpath:
            xpath: .//td[@class="main"]/b[. = "Auction expires on:"]/following-sibling::text()
      not_found:
        - find_by_xpath:
            xpath: './/table[@class="infoBoxContents"]/tr[2]/td[@class="boxText"]'
            pattern: !ruby/regexp '/Product not found/'
      message1:
      - value: 100
      #
      # Product attributes
      #
      product_caliber:
        - find_by_xpath:
            xpath: .//div[@id='mainmain']//td[@class='main']/center/table
            pattern: !ruby/regexp '/caliber\s*.*$/i'
      product_grains:
        - find_by_xpath:
            xpath: .//div[@id='mainmain']//td[@class='main']/center/table
            pattern: !ruby/regexp '/bullet weigth\s*\d{1,3}\s*gr/i'
          filters:
            - accept_grains
      product_number_of_rounds:
        - find_by_xpath:
            xpath: .//div[@id='mainmain']//td[@class='main']/center/table
            pattern: !ruby/regexp '/rounds\/box\s*\d{1,5}/i'
          filters:
            - accept_box_rounds
      product_mpn:
        - find_by_xpath:
            xpath: .//tr[@id='x2d']/td[1]/div[1]/div
            pattern: !ruby/regexp '/model:\s*.*?$/i'
          filters:
            - reject: !ruby/regexp '/model:\s*/i'
      product_upc:
        - find_by_xpath:
            xpath: .//tr[@id='x2d']/td[1]/div[1]/div
            pattern: !ruby/regexp '/upc:\s*\d+/i'
          filters:
            - accept: !ruby/regexp '/\d+/'
      product_category1:
        - label_by_xpath:
            label: Guns
            xpath: .//a[@class="breadcrumb_sep_link"][2]
            pattern: !ruby/regexp '/Guns|Rifles|California Compliant|BUDS VIP/i'
        - label_by_xpath:
            label: Guns
            xpath: .//a[@class="breadcrumb_sep_link"][3]
            pattern: !ruby/regexp '/Guns|Rifles|California Compliant|BUDS VIP/i'
        - label_by_xpath:
            label: Ammunition
            xpath: .//a[@class="breadcrumb_sep_link"][2]
            pattern: !ruby/regexp '/Ammunition/i'
        - label_by_xpath:
            label: Ammunition
            xpath: .//a[@class="breadcrumb_sep_link"][3]
            pattern: !ruby/regexp '/Ammunition/i'
        - label_by_xpath:
            label: Optics
            xpath: .//a[@class="breadcrumb_sep_link"][2]
            pattern: !ruby/regexp '/Scopes|Optics/i'
        - label_by_xpath:
            label: Optics
            xpath: .//a[@class="breadcrumb_sep_link"][3]
            pattern: !ruby/regexp '/Scope|Optics|Cameras/i'
        - label_by_xpath:
            label: Accessories
            xpath: .//a[@class="breadcrumb_sep_link"][3]
            pattern: !ruby/regexp '/Holsters|Magazine|Sights|Lasers|Lights|Rails|Stocks|Choke Tubes|Barrels|Cleaning|Safety|Cases|Mace|Muzzle|Reloading|Targets|Gunsmith|Rests|AR Upper|Parts|Pods|Boss|Boxes|Chronographs|Conversion|Ammo|Pads|Speedloaders|Swivels|Trigger|Wilson|Grips/i'
        - label_by_xpath:
            label: Accessories
            xpath: .//a[@class="breadcrumb_sep_link"][2]
            pattern: !ruby/regexp '/Doublestar Accessories/i'
  www.budsgunshop.com/product_page_no_script:
    schema: Listing
    queue: www.budsgunshop.com/listings
    xpath: '/html'
    attribute:
      #
      # Listing attributes
      #
      type: [{ value: RetailListing }]
      location: [{ value: "1105 Industry Road Lexington, KY 40505" }]
      title:
        - meta_title: ~
        - meta_og_title: ~
        - find_by_xpath:
            xpath: .//title
      description:
        - meta_og_description: ~
        - meta_description: ~
        - find_by_xpath:
            xpath: .//td[@class="main"]/p
      keywords:
        - meta_keywords: ~
      image:
        - meta_og_image: ~
        - find_by_xpath:
            xpath: .//div[@style="padding:0px 8px 2px 8px;"]//img/@src
            pattern: !ruby/regexp '/images\/.*jpg/'
          filters:
            - prefix: http://www.budsgunshop.com/catalog/
      sale_price_in_cents:
        - find_by_xpath:
            xpath: './/tr[@id="x2d"]/td[2]/div[1]/div[1]/div[2]/strong'
            pattern: !ruby/regexp '/^\$\d[\d\,\.]+/i'
      price_in_cents:
        - find_by_xpath:
            xpath: .//a[@id="buy"]/span
            pattern: !ruby/regexp '/^\$\d[\d\,\.]+/i'
        - find_by_xpath:
            xpath: './/tr[@id="x2d"]/td[2]/div[1]/div[1]/div[1]'
            pattern: !ruby/regexp '/^\$\d[\d\,\.]+/i'
      price_on_request:
        - find_by_xpath:
            xpath: .//a[@id="get_price_quote"]/@alt
            pattern: !ruby/regexp '/Get Quote/'
      availability:
        - label_by_xpath:
            label: out_of_stock
            xpath: .//span[@style="color:red; background:black; padding:3"]
            pattern: !ruby/regexp '/^Currently unavailable/i'
        - label_by_xpath:
            label: out_of_stock
            xpath: .//div/font[@color="red"]
            pattern: !ruby/regexp '/OUT OF STOCK/'
        - value: in_stock
      type:
        - label_by_url:
            label: auction
            pattern: !ruby/regexp '/auction_info.*auctions_id/'
        - label_by_url:
            label: retail
            pattern: !ruby/regexp '/product_info.*products_id/'
        - value: RetailListing
      condition:
        - label_by_xpath:
            label: New
            xpath: .//span[@style="font-size:9pt; color:#990000; font-weight:bold;"]
            pattern: !ruby/regexp '/Factory New/'
        - label_by_xpath:
            label: Used
            xpath: .//span[@style="font-size:9pt; color:#990000; font-weight:bold;"]
            pattern: !ruby/regexp '/Used/'
        - value: New
      current_bid_in_cents:
        - find_by_xpath:
            xpath: .//td[@class="main"]/b[. = "Auction price:"]/following-sibling::text()
            pattern: !ruby/regexp '/\$\d[\d\,\.]+/i'
      auction_ends:
        - find_by_xpath:
            xpath: .//td[@class="main"]/b[. = "Auction expires on:"]/following-sibling::text()
      not_found:
        - find_by_xpath:
            xpath: './/table[@class="infoBoxContents"]/tr[2]/td[@class="boxText"]'
            pattern: !ruby/regexp '/Product not found/'
      #
      # Product attributes
      #
      product_caliber:
        - find_by_xpath:
            xpath: .//div[@id='mainmain']//td[@class='main']/center/table//tr
            pattern: !ruby/regexp '/caliber\W*.*$/i'
      product_grains:
        - find_by_xpath:
            xpath: .//div[@id='mainmain']//td[@class='main']/center/table//tr
            pattern: !ruby/regexp '/bullet weigth\s*\d{1,3}\s*gr/i'
          filters:
            - accept_grains
      product_number_of_rounds:
        - find_by_xpath:
            xpath: .//div[@id='mainmain']//td[@class='main']/center/table//tr
            pattern: !ruby/regexp '/rounds\/box\s*\d{1,5}/i'
          filters:
            - accept_box_rounds
      product_mpn:
        - find_by_xpath:
            xpath: .//tr[@id='x2d']/td[1]/div[1]/div
            pattern: !ruby/regexp '/model:\s*.*?$/i'
          filters:
            - reject: !ruby/regexp '/model:\s*/i'
      product_upc:
        - find_by_xpath:
            xpath: .//tr[@id='x2d']/td[1]/div[1]/div
            pattern: !ruby/regexp '/upc:\s*\d+/i'
          filters:
            - accept: !ruby/regexp '/\d+/'
      product_category1:
        - label_by_xpath:
            label: Guns
            xpath: .//a[@class="breadcrumb_sep_link"][2]
            pattern: !ruby/regexp '/Guns|Rifles|California Compliant|BUDS VIP/i'
        - label_by_xpath:
            label: Guns
            xpath: .//a[@class="breadcrumb_sep_link"][3]
            pattern: !ruby/regexp '/Guns|Rifles|California Compliant|BUDS VIP/i'
        - label_by_xpath:
            label: Ammunition
            xpath: .//a[@class="breadcrumb_sep_link"][2]
            pattern: !ruby/regexp '/Ammunition/i'
        - label_by_xpath:
            label: Ammunition
            xpath: .//a[@class="breadcrumb_sep_link"][3]
            pattern: !ruby/regexp '/Ammunition/i'
        - label_by_xpath:
            label: Optics
            xpath: .//a[@class="breadcrumb_sep_link"][2]
            pattern: !ruby/regexp '/Scopes|Optics/i'
        - label_by_xpath:
            label: Optics
            xpath: .//a[@class="breadcrumb_sep_link"][3]
            pattern: !ruby/regexp '/Scope|Optics|Cameras/i'
        - label_by_xpath:
            label: Accessories
            xpath: .//a[@class="breadcrumb_sep_link"][3]
            pattern: !ruby/regexp '/Holsters|Magazine|Sights|Lasers|Lights|Rails|Stocks|Choke Tubes|Barrels|Cleaning|Safety|Cases|Mace|Muzzle|Reloading|Targets|Gunsmith|Rests|AR Upper|Parts|Pods|Boss|Boxes|Chronographs|Conversion|Ammo|Pads|Speedloaders|Swivels|Trigger|Wilson|Grips/i'
        - label_by_xpath:
            label: Accessories
            xpath: .//a[@class="breadcrumb_sep_link"][2]
            pattern: !ruby/regexp '/Doublestar Accessories/i'
  www.budsgunshop.com/product_page_scripts_only:
    scripts:
      - globals/product_page
      - www.budsgunshop.com/script
    schema: Listing
    xpath: '/html'
    queue: www.budsgunshop.com/listings
    attribute: {}
  www.budsgunshop.com/product_page_invalid_json_attribute:
    schema: Listing
    xpath: '/html'
    attribute:
      #
      # Listing attributes
      #
      listing_type: [{ value: RetailListing }]
      location: [{ value: "1105 Industry Road Lexington, KY 40505" }]
      title:
        - meta_title: ~
        - meta_og_title: ~
        - find_by_xpath:
            xpath: .//title
  www.budsgunshop.com/product_page_invalid_script_attribute:
    scripts:
      # - globals/* # Uses glob format
      - www.budsgunshop.com/invalid_script
    schema: Listing
    queue: www.budsgunshop.com/listings
    xpath: '/html'
    attribute: {}

